<?php

namespace App\Console\Commands;

use Illuminate\Console\Command;
use App\Models\Subscription\CustomerSubscription;
use App\Models\Unsubscription\CustomerUnSubscription;
use App\Models\Refund\RefundedCustomer;
use Carbon\Carbon;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Http;

class BankPolicy extends Command
{
    /**
     * The name and signature of the console command.
     *
     * @var string
     */
    protected $signature = 'bank:policy';

    /**
     * The console command description.
     *
     * @var string
     */
    protected $description = 'Command description';

    /**
     * Create a new command instance.
     *
     * @return void
     */
    public function __construct()
    {
        parent::__construct();
    }

    /**
     * Execute the console command.
     *
     * @return int
     */
    public function handle()
    {
        DB::enableQueryLog();
        $pairs = [
            ['03016735878',1600],
            ['03240655438',1950],
            ['03064918426',1600],
            ['03096286535',1950],
            ['03006140428',1600],
            ['03287799515',1950],
            ['03148499009',1600],
            ['03232430317',1950],
            ['03075652417',1600],
            ['03087976832',1950],
            ['03015648561',1600],
            ['03283887740',1600],
            ['03097827804',1950],
            ['03095453745',1600],
            ['03064726339',1950],
            ['03260283965',1600],
            ['03079557923',1600],
            ['03052085410',1950],
            ['03266552341',1600],
            ['03252799221',1950],
            ['03288137833',1600],
            ['03059232561',1950],
            ['03033548330',1600],
            ['03216044600',1950],
            ['03043360616',1600],
            ['03180457507',1600],
            ['03062824237',1600],
            ['03230044213',1600],
            ['03455444266',1950],
            ['03002740102',1600],
            ['03017314116',1600],
            ['03003247311',1600],
            ['03140389684',1600],
            ['03097408978',1600],
            ['03011267435',1950],
            ['03244785959',1600],
            ['03271507975',1600],
            ['03164720712',1950],
            ['03093878295',1600],
            ['03013554226',1950],
            ['03007369233',1600],
            ['03084360634',1950],
            ['03068686034',1600],
            ['03008701686',1950],
            ['03006807927',1600],
            ['03297577874',1950],
            ['03263238437',1600],
            ['03208461025',1950],
            ['03063441987',1600],
            ['03004373261',1600],
            ['03029744321',1950],
            ['03052381556',1600],
            ['03093420644',1600],
            ['03068078699',1600],
            ['03032921319',1950],
            ['03092397229',1600],
            ['03029325402',1600],
            ['03061478270',1950],
            ['03006758530',1600],
            ['03097576067',1950],
            ['03014043717',1600],
            ['03025182574',1950],
            ['03286370556',1600],
            ['03260130675',1950],
            ['03036466598',1600],
            ['03043812959',1950],
            ['03032514212',1600],
            ['03060115430',1950],
            ['03211385799',1600],
            ['03269351357',1950],
            ['03298900074',1600],
            ['03047757585',1950],
            ['03046974254',1600],
            ['03243231503',1600],
            ['03027253087',1950],
            ['03033799642',1600],
            ['03252901386',1950],
            ['03026818292',1600],
            ['03282405477',1600],
            ['03075323779',1600],
            ['03284237027',1950],
            ['03016937406',1600],
            ['03054632413',1950],
            ['03017771678',1600],
            ['03006642914',1950],
            ['03021569270',1600],
            ['03046702714',1950],
            ['03006782509',1600],
            ['03045488487',1950],
            ['03038115146',1600],
            ['03017394893',1950],
            ['03041870536',1600],
            ['03286059012',1950],
            ['03005270114',1600],
            ['03004253434',1950],
            ['03017143364',1600],
            ['03069266368',1950],
            ['03279178069',1600],
            ['03099182650',1950],
            ['03234620152',1600],
            ['03068416172',1600],
            ['03062910090',1950],
            ['03048439478',1600],
            ['03208545360',1600],
            ['03009211552',1950],
            ['03266385936',1600],
            ['03087468201',1950],
            ['03052871974',1600],
            ['03059983639',1950],
            ['03226941926',1950],
            ['03283932067',1600],
            ['03154510051',1950],
            ['03083622248',1600],
            ['03069229293',1950],
            ['03042040970',1600],
            ['03024701747',1950],
            ['03038605151',1600],
            ['03334668520',1950],
            ['03151462188',1950],
            ['03019811337',1600],
            ['03074113716',1600],
            ['03065404859',1600],
            ['03278146397',1950],
            ['03238454679',1600],
            ['03001592417',1600],
            ['03217040737',1950],
            ['03027667329',1600],
            ['03033574855',1950],
            ['03228438106',1600],
            ['03090017806',1600],
            ['03204177306',1950],
            ['03018786792',1600],
            ['03014879898',1950],
            ['03095421108',1600],
            ['03018993248',1600],
            ['03059422452',1950],
            ['03013313217',1600],
            ['03024765240',1950],
            ['03012694798',1600],
            ['03071704043',1950],
            ['03033360493',1600],
            ['03280619203',1950],
            ['03091514880',1600],
            ['03357830544',1950],
            ['03027872563',1600],
            ['03085554168',1600],
            ['03078155440',1600],
            ['03064502467',1950],
            ['03035451951',1600],
            ['03223416319',1600],
            ['03006508513',1600],
            ['03046530201',1950],
            ['03003186658',1600],
            ['03287373465',1950],
            ['03076530070',1600],
            ['03204783097',1950],
            ['03075203984',1600],
            ['03228708596',1950],
            ['03064815715',1600],
            ['03474545357',1950],
            ['03091621611',1600],
            ['03005658117',1950],
            ['03250243383',1600],
            ['03093552390',1950],
            ['03058319161',1600],
            ['03074162896',1950],
            ['03244424206',1600],
            ['03204749440',1950],
            ['03279000623',1600],
            ['03207982232',1950],
            ['03230466717',1600],
            ['03085185223',1950],
            ['03228423598',1600],
            ['03042839151',1950],
            ['03059727953',1600],
            ['03032041026',1600],
            ['03206445604',1600],
            ['03201027559',1600],
            ['03251525798',1600],
            ['03158947671',1950],
            ['03061970553',1600],
            ['03286203552',1950],
            ['03028571793',1600],
            ['03087000563',1950],
            ['03056279609',1600],
            ['03053295617',1950],
            ['03005437316',1600],
            ['03285953165',1600],
            ['03332812160',1950],
            ['03035550465',1600],
            ['03032158148',1950],
            ['03034643334',1600],
            ['03288389419',1950],
            ['03008108558',1600],
            ['03094021016',1600],
            ['03247729338',1950],
            ['03039903121',1600],
            ['03015260053',1600],
            ['03181745151',1950],
            ['03036112737',1600],
            ['03045674736',1950],
            ['03216589566',1950],
            ['03215457315',1600],
            ['03224708934',1950],
            ['03103227639',1600],
            ['03285910470',1950],
            ['03229378355',1600],
            ['03273342396',1950],
            ['03027580507',1600],
            ['03073825625',1950],
            ['03052474897',1600],
            ['03222740522',1950],
            ['03102249552',1600],
            ['03178484484',1950],
            ['03228208563',1600],
            ['03071489199',1600],
            ['03200441516',1950],
            ['03107802273',1600],
            ['03032883825',1950],
            ['03085162321',1600],
            ['03017709169',1950],
            ['03414321750',1600],
            ['03260271640',1600],
            ['03084874349',1950],
            ['03259982468',1600],
            ['03040072166',1600],
            ['03140172978',1950],
            ['03025749107',1600],
            ['03012727181',1950],
            ['03007333596',1600],
            ['03067536742',1950],
            ['03229741415',1600],
            ['03065176710',1950],
            ['03023182629',1600],
            ['03326086403',1950],
            ['03022058024',1600],
            ['03284375862',1950],
            ['03060020565',1600],
            ['03071961453',1950],
            ['03009243688',1600],
            ['03127422560',1950],
            ['03289896121',1600],
            ['03302797371',1600],
            ['03449133933',1950],
            ['03246154274',1600],
            ['03096839601',1600],
            ['03034587368',1950],
            ['03252141296',1600],
            ['03049032802',1950],
            ['03289641558',1600],
            ['03034383833',1950],
            ['03026981577',1600],
            ['03237839400',1950],
            ['03005658158',1600],
            ['03033500963',1950],
            ['03070715915',1600],
            ['03099007603',1950],
            ['03012040922',1600],
            ['03088320272',1950],
            ['03096064004',1600],
            ['03044489306',1600],
            ['03067400052',1950],
            ['03282717578',1600],
            ['03119199611',1950],
            ['03037564449',1600],
            ['03285002487',1950],
            ['03024621499',1600],
            ['03079000560',1950],
            ['03015617128',1600],
            ['03208424366',1950],
            ['03132586773',1600],
            ['03094592741',1600],
            ['03191873682',1950],
            ['03027272983',1600],
            ['03082279692',1600],
            ['03075626941',1950],
            ['03338249454',1600],
            ['03338697613',1600],
            ['03097713733',1950],
            ['03040036978',1600],
            ['03013258681',1950],
            ['03038551375',1600],
            ['03241618479',1950],
            ['03232900678',1600],
            ['03045518908',1600],
            ['03102460154',1950],
            ['03003288423',1600],
            ['03123446665',1950],
            ['03233205726',1600],
            ['03282280357',1600],
            ['03286349478',1950],
            ['03030098639',1600],
            ['03089083494',1950],
            ['03093837636',1600],
            ['03054238380',1950],
            ['03083541742',1600],
            ['03073650829',1950],
            ['03084246531',1600],
            ['03285126743',1950],
            ['03002491671',1600],
            ['03287006070',1950],
            ['03023961875',1600],
            ['03299656599',1950],
            ['03008788056',1600],
            ['03289225214',1950],
            ['03007961925',1600],
            ['03281319381',1950],
            ['03283000519',1600],
            ['03296310910',1950],
            ['03044052501',1600],
            ['03255337298',1950],
            ['03078200503',1600],
            ['03261240142',1950],
            ['03023648199',1600],
            ['03087979855',1600],
            ['03296640458',1950],
            ['03219586524',1600],
            ['03295095532',1950],
            ['03339404712',1600],
            ['03081603240',1950],
            ['03040482619',1600],
            ['03296904270',1950],
            ['03049660567',1600],
            ['03217402140',1950],
            ['03017584418',1600],
            ['03057320502',1950],
            ['03041968522',1600],
            ['03083928389',1950],
            ['03007026701',1600],
            ['03221147490',1950],
            ['03244504911',1600],
            ['03151185855',1950],
            ['03024856002',1600],
            ['03122467007',1950],
            ['03063427206',1600],
            ['03224356998',1950],
            ['03007811802',1600],
            ['03052070527',1950],
            ['03073283258',1600],
            ['03008597150',1950],
            ['03041566927',1600],
            ['03213632310',1950],
            ['03182401312',1600],
            ['03085248746',1950],
            ['03000296028',1600],
            ['03076648914',1950],
            ['03010765248',1600],
            ['03224076336',1950],
            ['03053330440',1600],
            ['03055811586',1950],
            ['03216244546',1600],
            ['03054094476',1950],
            ['03028950854',1600],
            ['03067716894',1950],
            ['03032780474',1600],
            ['03163174474',1950],
            ['03076588168',1600],
            ['03011638128',1950],
            ['03244040223',1600],
            ['03082432937',1950],
            ['03096865190',1600],
            ['03083603505',1950],
            ['03086329176',1600],
            ['03043656679',1950],
            ['03016541879',1600],
            ['03058411035',1950],
            ['03004824310',1600],
            ['03058248832',1950],
            ['03004998954',1600],
            ['03429392625',1950],
            ['03012075873',1600],
            ['03460425895',1950],
            ['03286886505',1600],
            ['03077531289',1950],
            ['03284484374',1600],
            ['03044490601',1950],
            ['03057523025',1600],
            ['03491203109',1950],
            ['03027213313',1600],
            ['03273476801',1950],
            ['03078921477',1600],
            ['03164025571',1950],
            ['03211143461',1600],
            ['03079881101',1950],
            ['03046675466',1600],
            ['03072705691',1950],
            ['03266534765',1600],
            ['03056967715',1950],
            ['03064050486',1600],
            ['03086437921',1950],
            ['03051338934',1600],
            ['03035551338',1950],
            ['03076205286',1600],
            ['03048488526',1950],
            ['03041615759',1600],
            ['03210066066',1950],
            ['03086149455',1600],
            ['03065738076',1950],
            ['03029800493',1600],
            ['03054141210',1950],
            ['03052618796',1600],
            ['03285397704',1950],
            ['03024197777',1600],
            ['03096059338',1600],
            ['03275042329',1600],
            ['03092885761',1950],
            ['03046881456',1600],
            ['03056556378',1950],
            ['03064293796',1600],
            ['03048645479',1950],
            ['03219040037',1600],
            ['03219040037',1600],
            ['03219040037',1600],
            ['03224975078',1600],
            ['03224975078',1600],
            ['03224975078',1600],
            ['03090097914',1600],
            ['03163385809',1950],
            ['03106271993',1600],
            ['03041208101',1600],
            ['03236657691',1600],
            ['03235126417',1600],
            ['03143315715',1600],
            ['03143315715',1600],
            ['03143315715',1600],
            ['03084961826',1600],
            ['03269728475',1600],
            ['03146832991',1600],
            ['03146832991',1600],
            ['03146832991',1600],
            ['03220376609',1600],
            ['03052038950',1600],
            ['03253497516',1600],
            ['03262978161',1600],
            ['03256628068',1600],
            ['03087745089',1950],
            ['03087745089',1950],
            ['03214675791',1950],
            ['03066350574',1600],
            ['03144829257',1600],
            ['03135288899',1600],
            ['03221007892',1600],
            ['03063657826',1600],
            ['03029886116',1600],
            ['03254856087',1600],
            ['03238163212',1950],
            ['03285531190',1600],
            ['03260804653',1600],
            ['03353920379',1600],
            ['03270656652',1950],
            ['03042913831',1600],
            ['03066348020',1600],
            ['03235515376',1600],
            ['03009027199',1600],
            ['03258829229',1950],
            ['03096969566',1600],
            ['03017746367',1600],
            ['03460023905',1600],
            ['03130106456',1600],
            ['03070077902',1950],
            ['03016972894',1600],
            ['03259938122',1950],
            ['03026237156',1600],
            ['03021744975',1950],
            ['03193665178',1600],
            ['03020001248',1600],
            ['03069002567',1950],
            ['03183708826',1600],
            ['03014956442',1950],
            ['03007274048',1600],
            ['03063142768',1600],
            ['03088769722',1600],
            ['03002086407',1600],
            ['03289503170',1600],
            ['03289503170',1950],
            ['03276962067',1600],
            ['03009690764',1600],
            ['03012228679',1600],
            ['03084070280',1600],
            ['03017961743',1600],
            ['03011463469',1600],
            ['03095306341',1600],
            ['03220376609',1600],
            ['03207619007',1600],
            ['03074433295',1600],
            ['03053146057',1600],
            ['03066924366',1600],
            ['03281562808',1600],
            ['03037141499',1950],
            ['03236147048',1600],
            ['03003504415',1600],
            ['03014948226',1950],
            ['03056464895',1600],
            ['03365158076',1600],
            ['03036770994',1600],
            ['03044809793',1600],
            ['03130106456',1600],
            ['03281743403',1600],
            ['03156650648',1600],
            ['03056352554',1600],
            ['03281318977',1600],
            ['03044970826',1600],
            ['03096036267',1950],
            ['03054950803',1950],
            ['03055346770',1600],

            // ...
        ];

        $subscriptions = CustomerSubscription::where(function ($query) use ($pairs) {
            foreach ($pairs as $pair) {
                $query->orWhere(function ($subQuery) use ($pair) {
                    $subQuery->where('subscriber_msisdn', $pair[0])
                        ->where('transaction_amount', $pair[1]);
                });
            }
        })->get();

        dd($subscriptions);


        foreach ($subscriptions as $subscription) {


            dd($subscription);


            $find_sub = CustomerSubscription::find($subscription->subscription_id);

            // $find_sub->policy_status = '0';
            // $find_sub->update();

            // $refundedCustomer = RefundedCustomer::create([
            //     'subscription_id' => $subscription->subscription_id,
            //     'unsubscription_id' => 2,
            //     'transaction_id' => $subscription->cps_transaction_id,
            //     'reference_id' => $subscription->referenceId,
            //     'cps_response' => $subscription->cps_response_text,
            //     'result_description' => $subscription->cps_response_text,
            //     'result_code' => 0,
            //     'refunded_by' => 'Danish2024',
            //     'medium' => 'Bank Refund',
            // ]);


            // $CustomerUnSub = CustomerUnSubscription::create([
            //     'unsubscription_datetime' => now(),
            //     'medium' => "Bank Refund",
            //     'subscription_id' => $subscription->subscription_id,
            //     'refunded_id' => $refundedCustomer->refund_id,
            // ]);
        }


        //  dd($subscriptions);
        return 'success';

    }
}
